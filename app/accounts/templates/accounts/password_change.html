{% extends 'base.html' %}
{% block title %}修改密码{% endblock %}
{% block content %}
<h5 class="mb-3">修改密码</h5>
<form method="post" class="card card-body">
	{% csrf_token %}
	<div class="mb-3">
		<label class="form-label">当前密码</label>
		<div class="input-group">
			<input type="password" name="old_password" class="form-control {% if form.old_password.errors %}is-invalid{% endif %}" required>
			<button type="button" class="btn btn-outline-secondary toggle-password">
				<i class="bi bi-eye"></i>
			</button>
		</div>
		{% for error in form.old_password.errors %}
			<div class="invalid-feedback d-block">{{ error }}</div>
		{% endfor %}
	</div>

	<div class="mb-3">
		<label class="form-label">新密码</label>
		<div class="input-group">
			<input type="password" name="new_password1" class="form-control {% if form.new_password1.errors %}is-invalid{% endif %}" required>
			<button type="button" class="btn btn-outline-secondary toggle-password">
				<i class="bi bi-eye"></i>
			</button>
		</div>
		{% for error in form.new_password1.errors %}
			<div class="invalid-feedback d-block">{{ error }}</div>
		{% endfor %}
	</div>

	<div class="mb-3">
		<label class="form-label">确认新密码</label>
		<div class="input-group">
			<input type="password" name="new_password2" class="form-control {% if form.new_password2.errors %}is-invalid{% endif %}" required>
			<button type="button" class="btn btn-outline-secondary toggle-password">
				<i class="bi bi-eye"></i>
			</button>
		</div>
		{% for error in form.new_password2.errors %}
			<div class="invalid-feedback d-block">{{ error }}</div>
		{% endfor %}
	</div>

	<div class="mt-3 d-flex gap-2">
		<button class="btn btn-primary" type="submit">提交</button>
		<a class="btn btn-light" href="{% url 'accounts:profile' %}">返回</a>
	</div>
</form>

<script>
	document.querySelectorAll('.toggle-password').forEach(btn => {
		btn.addEventListener('click', function () {
			document.querySelectorAll('input[type=password], input[type=text]').forEach(input => {
				if (input.type === 'password') {
					input.type = 'text';
				} else {
					input.type = 'password';
				}
			});
			document.querySelectorAll('.toggle-password i').forEach(icon => {
				icon.classList.toggle('bi-eye');
				icon.classList.toggle('bi-eye-slash');
			});
		});
	});
</script>
{% endblock %}
